$(document).ready(function(){function t(e){var t=$(e).attr("id"),n=$(e).find("span.title").html(),r=$("#currentdir").val(),i=r+t;$("ul#playlist").append($("<li/>",{"data-songurl":i,"class":"dragable",html:'<span class="play1">'+n+'</span><a href="javascript:void(0)" class="closeit">X</a>'}));$("#playlist").sortable()}function n(e){var t=$("#scraper").is(":checked");$.post("dirparser.php",{dir:e,scrape:t},function(e){r(e)})}function r(e){var t=$.parseJSON(e);$("#filelist").empty();var n=[];$.each(t,function(){this.type=="mp3"&&(this.artist!=null||this.title!=null?n.push('<div id="'+this.link+'" class="filez"><span class="pre-char">&#9836;</span> <span class="title">'+this.artist+" - "+this.title+"</span></div>"):n.push('<div id="'+this.link+'" class="filez"><span class="pre-char">&#9835;</span> <span class="title">'+this.link+"</span></div>"));this.type=="dir"&&n.push('<div id="'+this.link+'" class="dirz">'+this.link+"</div>")});$("#currentdir").val()!=startdir&&n.push('<div id=".." class="back">..</div>');$("#filelist").html(n)}var e=$("#jquery_jplayer_1").jPlayer({ready:function(){},swfPath:"jPlayer/jquery.jplayer/Jplayer.swf",supplied:"mp3",smoothPlayBar:!0,keyEnabled:!0});$("#currentdir").val(startdir);n(startdir);$("#filelist").on("click","div.filez",function(){t(this)});$("#save_playlist").on("click",function(){var e=$("ul#playlist li"),t=jQuery.makeArray(e),n=[];$.each(t,function(){n.push($(this).data("songurl"))});console.log(n);$.ajax({type:"POST",url:"savem3u.php",data:{stuff:n}}).done(function(e){console.log(e)})});$("#playlist_list li").on("click",function(){var e=$(this).find("a").data("filename");console.log(e);$.ajax({type:"POST",url:"playlists/playlist_parser.php",data:{filename:e},dataType:"json"}).done(function(e){console.log(e);$.each(e,function(e,t){$("ul#playlist").append($("<li/>",{"data-songurl":t,"class":"dragable",html:'<span class="play1">'+t+'</span><a href="javascript:void(0)" class="closeit">X</a>'}))});$("#playlist").sortable()})});$("#addall").on("click",function(){var e=document.getElementsByClassName("filez"),n=jQuery.makeArray(e);$.each(n,function(){t(this)})});$("#filelist").on("click","div.dirz",function(){var e=$(this).attr("id"),t=$("#currentdir").val(),r=t+e+"/";$("#currentdir").val(r);n(r)});$("#filelist").on("click","div.back",function(){if($("#currentdir").val()!=startdir){var e=$("#currentdir").val(),t=e+"../",r=e.split("/"),i="";for(var s=0;s<r.length-2;s++)i=i+r[s]+"/";$("#currentdir").val(i);n(t)}});$("body").on("click","a.closeit",function(e){$(this).parent().remove()});$("#clear").click(function(){$("#playlist").empty()});$("#download").click(function(){var e=encodeURIComponent($("#currentdir").val());$("#downframe").attr("src","zipdir.php?dir="+e)});$("#downloadPlaylist").click(function(){var e=$("ul#playlist li"),t=jQuery.makeArray(e),n=0;$.each(t,function(){$("<input>").attr({type:"hidden",name:n,value:$(this).data("songurl")}).appendTo("#downform");n++});$("#downform").submit();$("#downform").empty()});$("#jquery_jplayer_1").bind($.jPlayer.event.ended,function(e){if($("#playlist").find("li.current").length!=0){var t=$("#playlist").find("li.current");if($("#playlist").find("li.current").next("li").length!=0){var n=$("#playlist").find("li.current").next("li"),r=n.data("songurl");t.toggleClass("current");n.toggleClass("current");$(this).jPlayer("setMedia",{mp3:escape(r)});$(this).jPlayer("play")}}});$("#playlist").on("click","li span",function(){var e=$(this).parent().data("songurl");$("#playlist li").removeClass("current");$(this).parent().addClass("current");$("#jquery_jplayer_1").jPlayer("setMedia",{mp3:escape(e)});$("#jquery_jplayer_1").jPlayer("play")})});